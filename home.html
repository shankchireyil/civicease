{% extends "layout.html" %}
{% block content %}
<div class="container-fluid px-0">

    <div class="row mb-4 mt-3">
        <div class="col-12">
            <h2 class="text-center mb-4">Government Services Categories</h2>
            <p class="text-center text-muted">Click on any category to view related government services</p>
        </div>
    </div>

    <!-- PIE CHART SECTION -->
    <div class="container my-4">
        <h4 class="text-center mb-3">Trending Posts â€” Pie Chart</h4>
        <div style="width: 380px; margin: auto;">
            <canvas id="trendingPieChart"></canvas>
        </div>
    </div>

    <!-- FULL-WIDTH CATEGORY GRID -->
    <div class="row px-4">
        {% for category in categories %}
        <div class="col-lg-3 col-md-4 col-sm-6 mb-4">
            
            <!-- ENTIRE CARD IS NOW CLICKABLE -->
            <div class="card h-100 shadow-sm category-card"
                 onclick="window.location.href='{{ url_for('category_posts', category_id=category.rss_category_id) }}'"
                 style="cursor:pointer;">

                <div class="card-body">
                    <h5 class="card-title text-primary">{{ category.rss_category_name }}</h5>
                    <p class="text-muted small mb-1">
                        {{ category.count }} services available
                    </p>
                </div>

                <div class="card-footer bg-light border-0">
                    <small class="text-primary">
                        <i class="fas fa-arrow-right"></i> Click to explore
                    </small>
                </div>

            </div>

        </div>
        {% endfor %}
    </div>

</div>

<!-- CHART JS -->
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

<!-- PIE CHART SCRIPT -->
<script>
    const pieCtx = document.getElementById('trendingPieChart');

    const trendingPieChart = new Chart(pieCtx, {
        type: 'pie',
        data: {
            labels: {{ chart_labels|tojson }},
            datasets: [{
                data: {{ chart_values|tojson }},
                backgroundColor: [
                    'rgba(255, 99, 132, 0.7)',
                    'rgba(54, 162, 235, 0.7)',
                    'rgba(255, 206, 86, 0.7)',
                    'rgba(75, 192, 192, 0.7)',
                    'rgba(153, 102, 255, 0.7)'
                ],
                borderColor: [
                    'rgb(255, 99, 132)',
                    'rgb(54, 162, 235)',
                    'rgb(255, 206, 86)',
                    'rgb(75, 192, 192)',
                    'rgb(153, 102, 255)'
                ],
                borderWidth: 2
            }]
        },
        options: {
            responsive: true,
            plugins: {
                legend: {
                    position: 'bottom'
                }
            }
        }
    });
</script>

<style>
    /* CATEGORY CARD HOVER EFFECT */
    .category-card:hover {
        transform: translateY(-5px);
        box-shadow: 0 4px 15px rgba(0,0,0,0.15) !important;
    }

    .category-card {
        border: 1px solid #e0e0e0;
        border-radius: 10px;
        min-width: 240px;
    }

    .category-card h5 {
        white-space: normal;
        word-break: normal;
    }
</style>

{% endblock content %}
